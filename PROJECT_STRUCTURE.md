# 积分管理系统 - 项目结构说明

## 📁 项目目录结构

```
jifen/
├── app.py                          # 主应用文件
├── users.csv                       # 用户账户数据
├── PROJECT_STRUCTURE.md            # 项目结构说明（本文件）
├── HISTORICAL_DATA_GUIDE.md        # 历史数据处理指南
├── templates/                      # HTML模板文件夹
│   ├── index.html                  # 系统首页
│   ├── login.html                  # 登录页面
│   ├── register.html               # 注册页面
│   ├── query_result.html           # 查询结果页面
│   ├── admin_upload_combined.html  # 数据上传页面（合并版）
│   └── admin_points.html           # 积分管理页面
├── static/                         # 静态文件夹（CSS、JS、图片等）
├── uploads/                        # 文件上传临时目录
├── data/                          # 用户数据存储目录
│   └── [username]/                # 各用户的专属数据目录
│       ├── user_points.csv        # 用户积分统计
│       └── points_history.csv     # 积分历史记录
└── README.md                      # 项目说明文档
```

## 🔧 核心文件说明

### 主应用文件
- **app.py**: Flask主应用，包含所有路由和业务逻辑

### 用户管理
- **users.csv**: 存储用户账户信息（用户名、密码哈希、邮箱等）

### 模板文件
- **index.html**: 系统首页，展示功能导航和统计信息
- **login.html**: 用户登录页面，支持表单验证和友好提示
- **register.html**: 用户注册页面，包含密码强度检测
- **query_result.html**: 积分查询结果展示页面
- **admin_upload_combined.html**: 数据上传和结果展示合并页面
- **admin_points.html**: 积分管理页面，支持筛选、排序、分页

### 数据存储
- **data/**: 用户数据根目录
  - **[username]/**: 每个用户的专属数据目录
    - **user_points.csv**: 用户积分统计表
    - **points_history.csv**: 积分历史记录表

### 临时目录
- **uploads/**: 文件上传临时存储目录
- **static/**: 静态资源目录（如需要）

## 🚀 快速启动

### 1. 环境要求
```bash
Python 3.7+
pandas
flask
openpyxl  # Excel文件支持
```

### 2. 安装依赖
```bash
pip install flask pandas openpyxl
```

### 3. 启动应用
```bash
python app.py
```

### 4. 访问系统
- 首页: http://127.0.0.1:5000/
- 登录: http://127.0.0.1:5000/login
- 注册: http://127.0.0.1:5000/register

### 5. 默认账户
- 用户名: admin
- 密码: admin123

## 📊 功能模块

### 用户认证
- ✅ 用户注册和登录
- ✅ 密码加密存储
- ✅ 会话管理
- ✅ 登录状态保护

### 数据管理
- ✅ 多格式文件上传（CSV、Excel、TSV、JSON）
- ✅ 智能列名识别和映射
- ✅ 空数据清理和验证
- ✅ 历史数据处理

### 积分系统
- ✅ 基于观看时长的积分计算（≥40分钟得1分）
- ✅ 90天有效期管理
- ✅ 防重复计分机制
- ✅ 用户专属数据隔离

### 查询统计
- ✅ 用户积分查询
- ✅ 模糊搜索支持
- ✅ 积分统计和排序
- ✅ 分页显示

### 管理功能
- ✅ 积分管理界面
- ✅ 数据筛选和排序
- ✅ 批量数据处理
- ✅ 实时统计显示

## 🔒 数据安全

### 用户隔离
- 每个管理员的数据存储在独立目录
- 登录用户只能访问自己的数据
- 数据文件路径基于用户ID动态生成

### 密码安全
- 使用SHA256哈希加密存储密码
- 不存储明文密码
- 支持密码强度验证

### 会话安全
- Flask session管理用户状态
- 登录保护装饰器
- 自动登出机制

## 📝 数据格式

### 支持的上传格式
- **CSV**: 逗号分隔值文件
- **Excel**: .xlsx, .xls格式
- **TSV**: 制表符分隔文件
- **JSON**: JSON格式数据

### 必需的数据列
- **用户标识**: 用户ID、用户编号等
- **用户名称**: 用户昵称、用户名等
- **观看时长**: 直播观看时长
- **时间信息**: 观看时间（可选，用于历史数据）

## 🛠️ 维护说明

### 日常维护
- 定期清理uploads目录中的临时文件
- 监控data目录的磁盘使用情况
- 备份users.csv用户数据文件

### 数据备份
- 重要数据存储在data/目录下
- 建议定期备份整个data/目录
- users.csv包含用户账户信息，需要特别保护

### 日志监控
- 应用运行日志输出到控制台
- 关注错误信息和异常情况
- 监控文件上传和处理过程

## 📈 扩展建议

### 功能扩展
- 添加数据导出功能
- 实现邮件通知功能
- 增加数据可视化图表
- 支持更多文件格式

### 性能优化
- 大文件处理优化
- 数据库存储替代CSV
- 缓存机制实现
- 异步处理支持

### 安全增强
- HTTPS支持
- 更强的密码策略
- 操作日志记录
- 访问频率限制

---

**版本**: v2.0  
**更新时间**: 2024-01-15  
**维护者**: 积分管理系统开发团队
