# 积分管理系统 - Flask版本

传统的Python Flask Web应用版本，适合本地部署和完全控制的场景。

## ✨ 特性

- 🐍 **Python Flask**: 成熟稳定的Web框架
- 📊 **pandas**: 强大的数据处理能力
- 📁 **CSV存储**: 简单直观的数据存储
- 🔒 **会话管理**: Flask内置会话系统
- 🎨 **Jinja2模板**: 灵活的模板引擎

## 🚀 快速开始

### 环境要求
- Python 3.7+
- pip

### 安装依赖
```bash
pip install flask pandas openpyxl
```

### 启动应用
```bash
python app.py
```

### 访问系统
打开浏览器访问: http://127.0.0.1:5000/

### 默认账户
- 用户名: `admin`
- 密码: `admin123`

## 📁 项目结构

```
flask-version/
├── app.py                          # Flask主应用
├── users.csv                       # 用户数据
├── templates/                      # Jinja2模板
│   ├── index.html                  # 首页
│   ├── login.html                  # 登录页
│   ├── register.html               # 注册页
│   ├── admin_upload_combined.html  # 上传页面
│   ├── admin_points.html           # 积分管理
│   ├── query_page.html             # 查询页面
│   └── query_result.html           # 查询结果
├── data/                          # 用户数据目录
│   └── [username]/                # 用户专属目录
│       ├── user_points.csv        # 积分统计
│       └── points_history.csv     # 历史记录
└── uploads/                        # 上传临时目录
```

## 📊 功能特性

### 用户管理
- ✅ 用户注册和登录
- ✅ 密码加密存储
- ✅ 会话管理
- ✅ 多用户数据隔离

### 数据处理
- ✅ 多格式文件上传（CSV、Excel、TSV、JSON）
- ✅ 智能列名识别
- ✅ 空数据清理
- ✅ 历史数据处理

### 积分系统
- ✅ 基于观看时长计算积分（≥40分钟得1分）
- ✅ 90天有效期管理
- ✅ 防重复计分
- ✅ 实时统计

### 查询功能
- ✅ 用户积分查询
- ✅ 模糊搜索
- ✅ 分页显示
- ✅ 排序筛选

## 🔧 配置说明

### 数据存储
- 用户数据存储在 `users.csv`
- 每个用户的积分数据存储在独立目录 `data/[username]/`
- 上传文件临时存储在 `uploads/` 目录

### 安全配置
- 密码使用SHA256哈希加密
- Flask Session管理用户状态
- 登录保护装饰器

## 🛠️ 开发指南

### 添加新功能
1. 在 `app.py` 中添加路由
2. 创建对应的模板文件
3. 更新导航菜单

### 数据库操作
- 使用pandas读写CSV文件
- 数据清理和验证
- 文件路径管理

### 模板开发
- 使用Jinja2模板语法
- 响应式CSS设计
- JavaScript交互功能

## 📈 性能优化

### 文件处理
- 大文件分块处理
- 内存使用优化
- 临时文件清理

### 数据查询
- 索引优化
- 分页查询
- 缓存机制

## 🔒 安全建议

### 生产部署
- 使用HTTPS
- 设置强密码策略
- 定期备份数据
- 监控访问日志

### 数据保护
- 定期备份 `users.csv` 和 `data/` 目录
- 设置文件权限
- 数据加密存储

## 🆘 故障排除

### 常见问题
1. **端口占用**: 修改 `app.py` 中的端口号
2. **依赖缺失**: 运行 `pip install -r requirements.txt`
3. **权限问题**: 确保对数据目录有读写权限
4. **编码问题**: 确保CSV文件使用UTF-8编码

### 日志调试
- 查看控制台输出
- 检查Flask调试信息
- 验证文件路径和权限

## 📞 技术支持

如有问题，请查看：
- 项目文档: `../docs/`
- 历史数据处理指南
- 项目结构说明

---

**适用场景**: 本地部署、内网使用、完全控制、传统架构
